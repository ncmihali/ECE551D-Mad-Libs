#include "rand_story.h"

#include <stdio.h>
#include <stdlib.h>
#include <string.h>

catarray_t * allocate_cat(void) {
  catarray_t * cats = malloc(100 * sizeof(*cats));
  cats->arr = malloc(sizeof(*cats->arr));
  return cats;
}

void read_story(FILE * fp) {
  char temp[10000];
  while ((fscanf(fp, "%s", temp)) != EOF) {
    if (!(strcmp(temp, "\0")))
      printf("\n");
    size_t size = strlen(temp);
    if ((temp[0] == '_' && temp[size - 1] == '_') ||
        (temp[0] == '_' && temp[size - 1] == '.' && temp[size - 2] == '_')) {
      if (temp[size - 1] == '.') {
        strcpy(temp, chooseWord("", NULL));
        printf("%s. ", temp);
        continue;
      }
      else {
        strcpy(temp, chooseWord("", NULL));
      }
    }
    else if ((temp[0] == '_' && temp[size - 1] != '_') ||
             (temp[0] != '_' && (temp[size - 1] == '_' || temp[size - 2] == '_'))) {
      perror("invalid blank");
      exit(1);
    }
    printf("%s ", temp);
  }
  printf("\n");
}
